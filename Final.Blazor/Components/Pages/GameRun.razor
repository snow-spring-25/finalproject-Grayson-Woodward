@page "/GameRun"
@rendermode InteractiveServer
<h1>Multiplayer Hangman</h1>
<div class="xcontainer">
    <div>

        @if (!joined)
        {
            <p>Enter your name to join:</p>
            <input @bind="playerName" placeholder="Your name" />
            <button @onclick="JoinGame">Join</button>
        }
        else if (!gameStarted)
        {
            <p>Waiting for players... (@game.PlayerScores.Count / 2)</p>
            @foreach (var name in game.PlayerScores.Keys)
            {
                <p>@name joined</p>
            }

            @if (game.PlayerScores.Count == 2)
            {
                <button @onclick="StartGame">Start Game</button>
            }
        }
        else
        {
            <h3>Game Started!</h3>
            <p>Word: @game.CurrentMaskedWord</p>
            <p>Current Player: @game.CurrentPlayer</p>
            <p>Attempts Left: @attemptsLeft</p>
        }
    </div>
    <img id="image"src="@imgPath"/>
</div>




@code
{
    MultiplayerHangmanGame game = MultiplayerHangmanGame.Instance;
    private string playerName = "";
    private bool joined = false;
    private bool gameStarted = false;
    private int attemptsLeft => typeof(MultiplayerHangmanGame)
        .GetField("attemptsLeft", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)!
        .GetValue(game) as int? ?? 0;
    int imgNum =0;
    string imgPath => $"step {imgNum}.png";

    protected override void OnInitialized()
    {
        base.OnInitialized();
        game.OnGameStateChanged += () => InvokeAsync(StateHasChanged);
    }
    private void JoinGame()
    {
        try
        {
            game.AddPlayer(playerName);
            joined = true;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error joining game: {ex.Message}");
        }
    }
    private void StartGame()
    {
        try
        {
            game.Start();
            gameStarted = true;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error starting game: {ex.Message}");
        }
    }
}